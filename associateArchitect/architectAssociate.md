# AWS Certified Developer Associate - SAA-C02

- Download slides at: https://courses.datacumulus.com/downloads/certified-solutions-architect-pn9/

## IAM & AWS CLI

- Cloud Overview
    - AWS Regions: Cluster of data centers. us-east-1, eu-west-3
    - Availability zones: each region has many availabilty zones. One or more discrete data centers with redundant power, networdking and connectivity. They are seperate from each other, so they are isolated from disasters. They're connected with high bandwidth, ultra-low latency networking. For example: us-east-1a
    - factors for choosing aws regions: government requirements, proximity to customers, available services within a region, pricing
- IAM: identity access management. It is a global service
    - root account created by default, shouldnt be used or shared
    - users are people within your organization, and can be grouped. Usres dont have to be in groups, but can be in multiple groups. They can also have inline policies
        - users or groups can be assigned JSON documents called policies
        - least privilidge principle: dont give more permissions than a user needs
    - IAM Policices Structure
        - consists of version number, id, statement
        - statments consists of sid, effect (allow or deny service), principal(which account it is applied to), action(api calls allowed), resource(list of resources applied to), condition(optional. conditions when statment is applied)
    - Protect IAM Accounts
        - Password policy
        - Multi Factor Authentication (MFA)
    - How users can access AWS
        - options
            - AWS Management console (protected by password + MFA)
            - AWS CLI: protected by access key
            - AWS SDK: for code protected by access keys
        - access keys generated by AWS console. users manage their own access keys
        - access key is username. Secret access key is password
    - **Cloudshell**: browser based shell. Available top right side of nav bar. Not available in all regions
        - All files created in cloudshell exists even after shell restarted
    - IAM Roles: some AWS service will need to perform actions on your behalf. To do so, we will assign permissions to AWS services IAM Roles
        - Common roles: EC2 instance roles, lambda function roles, roles for cloudformation
    - IAM Security Tools
        - IAM Credentials Report (account-level): a report that lists all your account's users and the status of their various credentials
        - IAM Access Advisor (user-level): access advisor shows the service permissions granted to a user and when those services were last accessed. You can use this information to revise your policies

## EC2 Fundamentals

- **EC2 (Elastic Compute Cloud)**: infrastructure as a service
    - Consists of
        - Renting virtual machines (EC2)
        - storing data on virtual drives (EBS)
        - distributing load across machines (ELB)
        - scaling the services using an auto-scaling group (ASG)
    - Config options
        - Operating system: linux, windows, mac os
        - how much compute power and cores (CPU)
        - how much random-access memory (RAM)
        - how much storage space
            - network attached (EBS & EFS)
            - hardware (EC2 Instance store)
        - network card: speed of the card, public IP address
        - firewall rules: security group
        - Bootstrap script (configure at first launch): EC2 user data
- EC2 user data: automate boot tasks. Only run once at the instance first start. EC2 User data script runs as root user so sudo privileges
- EC2 Instance types
    - general purpose: great for a diversity of workloads such as web servers or code repositories. Ex: t2.micro
    - compute optimized: great for compute intensive tasks that require high performance processors such as batch workloads, emdia transcoding, high performance web servers, machine learning, game servers. Ex: C series
    - memory optimized: fast performance for workloads that process large data sets in memory such as high performance relational/non-relation databases, distributed web scale cache store, in-memory databases, applications performing real time processing of big unstructured data. Ex: R series
    - storage optimized: great for storage-intensive tasks that require high, sequential read and write access to large data sets on local storage such as high transaction online transaction processing, data warehousing applications, distributed file systems. Eg: I or D series
    - ex: m5.2xlarge means m (instance class), 5 (generation), 2xlarge(size within the instance class)
- Security groups: control how network traffic is allowed. Fundamental to network security. They are firewall
    - Only contains allow rules. Can reference by IP or by security group
    - Regulate: access to ports, authorized ip ranges, control of inbound/outbound network
    - Good to know
        - can be attached to multiple instances
        - locked down to a region / VPC combination
        - lives outside the EC2. If traffic is blocked the EC2 isntance wont see it
        - good to maintain one seperate security group for SSH access
        - if your application is not accessible (timeout), then its a security group issue. If your application gives a "connection refused" error, then its an application error or its not launched
        - by deafult all inbound traffic is blocked. all outbound traffic is allowed
- Ports to know
    - 22 = SSH (Secure shell) - log into a linux instance
    - 21 = FTP (File Transfer Protocol) - upload files into a file share
    - 22 = SFTP (Secure file transfer protocol) - upload files using SSH
    - 80 = HTTP - access unssecured websites
    - 443 = HTTPS - access secured websites
    - 3389 = RDP (Remote Desktop Protocol) - log into a windows instance
- **Instance connect**: ssh into ec2 instance from browser
- Reminder: IAM Roles can be attached to EC2 instances. This is how we let the EC2 instance interact with AWS services
- EC2 instances purchasing options
    - on demand instances: short workload, predictable pricing
        - highest cost but no upfornt payment. No long term commitment
        - recommended for short term and un-interrupted workloads
    - reserved (1 or 3 years): 75% discount compared to on-demand. Recommended for steady state usage applications
        - reserved instances: long workloads
        - convertible reserved instances: long workloads with flexible instances
            - can change EC2 instance type. 54% discount
        - scheduled reserved instances: launch within time window you reserve
    - spot instances: short workloads, cheap, can lose instances (less reliable)
        - can get upto 90% discount compared to On-demand
        - instances that you can 'lose' at any point of time if your max price is less than the current spot price
        - useful for workloads that are resilient to failure: batch jobs, data analysis, any distributed workloads. Bad for critical jobs
        - steps to terminate spot instances: cancel spot request and then terminate the instances
    - spot block instances: reserve a spot on EC2 instances for a specified duration (1-6 hours) without interruption
    - dedicated hosts: book an entire physical server, control instance placement
        - helps with compliance requirements and reduce costs by allowing you to use your existing server-bound software licenses
        - more expensive. require 3 year reservation period
    - dedicated isntances: instances running on hardware that's dedicated to you. May share hardware with other instances in same account
- **Spot Fleets** = set of spot instances + (optional) on-demand instances. Allows us to automatically request Spot instancs with the lowest price
    - the spot fleet will try to meet the target capacity with price constaints
        - can have multiple launch pools, so that the fleet can choose
        - spot fleet stops launching instaces when reaching capacity or max cost
    - strategies to allocate spot instances
        - lowestPrice: from the pool with the lowest price (cost optimization, short workload)
        - diversified: distributed across all pools (great for availalbility, long workloads)
        - capacityOptimized: pool with the optimal capacity for the number of instances
- IPv4 most common format used online. IPv6 is newer and solves problems for IoT
- Private vs Public vs Elastic IP
    - Public IP: accessible over the internet. Unique to WWW
    - Private IP: accessible to devices in private network. Two different private networks (two companies) can have the same IPs. Machines connect to WWW using a NAT + internet gateway (proxy)
    - Elastic IPs: fixed public IP for instance, and can be attached to one instance at a time. It is a public IPv4 as long as its not deleted. Try to avoid Elastic IPs as it reflects poor architectural decisions
- **Placement Groups**: want control over the EC2 Instance placement strategy
    - Strategy
        - Cluster: clusters instances into a low latency group in a single AZ
            - Pros: great network
            - Cons: if the rack fails, all instances fails at the same time
            - Use case: big data job, low latency and high throughput apps
        - Spread: spreads instances across underlying hardware (max 7 instances per group per AZ). Used for critical applications
            - Pros: span across multiple AZ. Reduced risk is simultaneous failure. EC2 instances are on different physical hardware
            - Cons: limited to 7 instances per AZ per placement group
            - Use case: application needs to maximize high availability. Used in critical applications
        - Partition: spreads instances across many different particions (which rely on different sets of racks) within an AZ. Scales to 100s of EC2 instances per group (hadoopm cassandra, kafka)
            - Use cases: big data applications
- **ENI (Elastic Network Interface)**: logical component in a VPC that represent a virtual network card (advanced use cases)
    - ENI attributes
        - Primary private IPv4, one or more secondary IPv4
        - One elastic IP (IPv4) per private
        - one pylbic IPv4
        - one or more security groups
        - a mac address
    - bound to specific AZ. ENI can be created independently and attech them on the fly on EC2 instances failover
- EC2 Hibernate: in-memory (RAM) state is preserved. The instance boot is much faster. Under the hood the RAM state is written to a file in the root EBS volume. The root EBS volume must be entrypted. Instance cannot be hibernated for more than 60 days. Use cases: long-running processing, saving RAM state, services take a while to initilize
    - stop: the data on disk (EBS) is kept intace in the next start
    - terminate: any EBS volumes (root) also set-up to be destroyed is lost
- EC2 Nitro: underlying platform for the next generation of EC2 instances
    - allows better performance:
        - better networking options
        - higher speed DBS
    - better underlying security
- vCPU
    - multiple threads can run on one CPU (multithreading)
    - each thread is represented as a virtual CPU (vCPU)
    - ex: m5.2xlarge has 4 cup and 2 threads per CPU. Therefore 8 vCPU
- Capacity Reservations: ensure you have EC2 Capacity when needed
    - manual or planned end-date for the reservation
    - no need for 1 or 3 year commitment
    - capacity access is immediate, you get billed as soon as it starts
    - can be combined with reserved instances and savings plans to do cost savings
- Elastic Block Store (EBS) Volume: network drive you can attach to your instances while they run
    - allows instances to persist data, even after termination
    - can be mounted on one instance at a time and bound to specific AZ. An instance can have multi EBS
    - have provisoned capacity (size in GB, IOPs)
    - delete on termincation attribute contols the behavious when ec2 instance terminates. Use case: preserve root volume when instance is terminated
    - think of it as a 'network usb stick'
    - EBS snapshots: make a backup of EBS volume at a point in time. Can copy snapshots across AZ or Region
    - Volume types
        - gp2/gp3 (SSD): general perfomance SSD. cost effective, low latency. Can be used for system boot volumes
        - io1/io2: highest performance SSD. Can be used for boot volume
            - Ebs multi attach: attach the same ebs volume to multiple ec2 instances in the same AZ. Must use file system that is cluster aware
        - st1 (HDD): cannot be used for boot volume
        - sc1 (HDD): lowest cost HDD. cannot be used for boot volume
        - provisoned IOPS (SSD): critical business applications with sustained IOPS performance
    - encryption: data at rest in rest and in flight is encrypted. all snapshots and all volumes created from the snapshot are encrypted
        - encryption and decryption are handled transparently (you have nothing to do)
        - encryption leverages keys from the KMS (AES-256)
- Instance Store: high performance hardware disk. Physical connection
    - EBS volumes are network drives with good but limited performance
    - Instance sstore has high I/O performance. They will lose their strage if they're stopped. It is good for buffer/cache. Risk of data loss if hardware fails. Backsups and replication are users responsibility
- Amazon Machine Image (AMI): customization of an EC2 instance
    - add own software, configuration, operating system etc
    - faster boot/configuration time because all your software is pre-packaged
    - AMI are built for a specific region but can be copied across regions
    - launch EC2 instance from:
        - public ami: aws provided
        - own ami: make and maintain yourself
        - aws marketplace ami: an ami someone else made (and potentially sells)
- Elastic File System (EFS): managed NFS (network file system) that can be mounted on many EC2
    - EFS works with EC2 instances in multi-AZ
    - highly available, scalable, expensive (3x gp2 EBS), pay per use
    - Compatible with Linux base AMI (not windows)
    - Types
        - perfomance mode
        - throughput mode
        - storage tiers
- EBS vs EFS
    - ebs can be attached to only one instance at a time. Are locked at the AZ level. To migrate need to take a snapchot and restore the snapshot on another AZ
    - efs can be mounted to many instances across AZ. Only for linux instances. EFS has a higher price point than EBS

## High Availability and Scability

- Saclability means that an application can heandle greater loads by adapting
    - Verical scalability: means increasing the size of the instance. very common for non distributed systems, such as a database. But there is a hardware limit
    - Horizontal scalability: means increasing the number of instances/systems for application. Implies distributed systems.
- High availability: usually goes hand in hand with horizontal scaling. Means running application/system in at least 2 data centers (AZ). Goal is to survive data center loss
- Load Balancers: are servers that forward traffic to multiple servers downstream
    - spread load across multiple downstream instances
    - expose a single point of access (DNS) to your application
    - do regular health checks downstream and seamlessly handle failures of downstream instances
    - provide ssl termination for websites
    - enforce stickiness with cookies
    - seperate public traffic from private traffic
- **Elastic Load Balacer (ELB)**: is a managed load balancer
- Types of loadbalancers
    - Classic Load Balancer (CLB): old. support TCP (layer 4), HTTP & HTTPS (Layer 7)
    - Application Load Balancer (ALB): supports https, https, websocket (layer 7 LB). They are a great fit for micro services & container based application (ex Docker & ECS). It allows load balancing to multiple applications on the same machine (ex: containers)
        - Routing tables to different url target groups
            - Routing based on path in URL
            - Routing based on hostname in URL
            - routing based on query string params and headers
        - Application servers dont see the IP of the client directly. True IP of client is in the header X-Forwarded-For
    - Network Load Balancer (NLB): supports tcp, tls (secure tcp), udp (layer 4 LB). handle milliosn of requests per second. Very low latency
        - NLB has one static IP per AZ, and supports assigning Elastic IP
        - NLB are used for extreme performance
    - Gateway load blancers (GWLB): operates at layer 3(network layer). IP Protocol
        - Deploys, scale and amange a fleet of 3rd party netwrok virtual appliances in AWS
            - Ex: firewalls, intrusion detection and prevention systems, deep packet inspection systems, payload manipulation. Inspect it before it reaches application
        - Combines: transport network gateway (entry/exit) for all traffic, loadbalancer (distribute traffic to appliances)
        - uses the GENEVE protocol on port 6081
- Load balancer security groups
    - users connect to load balancer: port 80 http, 443 https. Source is 0.0.0.0/0 so everywhere
    - load balancer connects ec2: http port 80. Source is security group
- Sticky sessions (session affinity): same client is always redirected to the same instance behind a load balancer
    - this works for CLB and ALB
    - the 'cookie' used for stickiness has an expiration date you control
    - use case: make sure the user doesnt lose session data, however may bring imbalance to EC2 instances
    - types of cookie
        - application based cookies
            - custom cookie: custom cookie that is generated by target, can include any custom attributes
            - application cookie: generated by the loadbalancer, cookie name is AWSALBAPP
        - duration based cookies
            - cookie generated by the load balancer
- Cross zone load balancing: each load balancer instance distributes evenly across all registered instances in all AZ
    - ALB: always on. No charges for inter AZ data
    - NLB: disabled by default. Pay for charges for inter AZ data if enabled
    - CLB: disabled by default. No charges for inter AZ data if enabled
- SSL Certificates: allows traffic between your clients and LB to be encrypted in transit (in flight encryption)
    - Secure Transport Layer (SSL): used to encrypt connections
    - Transport Layer Security (TLS): newer version
    - TLS certificates are mainly used but people still refer as SSL
    - SSL certificates can be manged using AWS certificate manager (ACM)
        - CLB: one SSL
        - ALB: multiple SSL, uses SNI to make it work
        - NLB: mmultiple SSL, uses SNI to make it work
- Server Name Indication (SNI): solves the problem of loading multiple SSL certificates onto one server (to serve multiple websites)
    - only works for ALB, NLB, Cloudfront
- Connection draining / deregistration delay: time to complete in-flight requests while the instances are de-registering or unhealthy. Stops sending new requests to the EC2 instance which is de-registering
- **Auto Scaling Group (ASG)**: scale out /in (add/remove EC2 instances) to match load. Automatically register new instance to LB
    - ASG have following attributes
        - launch configuration
        - min size / max size / initial capacity
        - network + subnets information
        - load balancer information
        - scaling policies
    - alarms: possible to scale an ASG based on cloudwatch alarms
        - metrics are computed for the overall ASG instances
- ASG Scaling Policies
    - scaling policies
        - Dynamic scaling policies
            - Target tracking scaling: ex: want the average ASG cpu to stay around 40%
            - Simple/step scaling
        - Scheduled actions: anticipate scaling based on known usage patterns
        - Predictive scaling: continuously forecast load and schedule scaling ahead
    - good metrices to scale on: CPUUtilization, RequestCountPerTarget, Average Network In/Out
    - scaling cooldown: after a scaling activity happens, it enters cooldown period (default 300 seconds). During cooldown period the ASG will not launch or terminate additional instances to allow for metrics to stabilize
- ASG Default termination policy
    1. find the az which has the most number of instances
    2. if there are multiple instances in the AZ to chosse from, delete the one with the oldest launch configuration
- Lifecycle hooks
    - have the ability to perform extra steps before the instance goes in service (pending state)
    - have the ability to perform some actiosn before the instance is terminated (terminating state)
- Launch template vs launch config
    - both allow how ec2 instance as part of asg is launched
    - launch config: old. must be recreated every time
    - launch template: new. can have multiple versions. create parameter subsets (partial configuration for re-use and inheritance). Provision using both On-Demend and Spot instances (or a mix)

## RDS, Aurora, ElastiCache

- Relational Database Service (RDS): managed DB service
    - DB Engines managed: Postgres, MySQL, mariaDb, Oracle, Microsoft SQL server, Aurora (AWS Proprietary database)
    - there are continuous backups and restore to specific timestamp
        - automatically enabled
        - daily backup of database
        - transaction logs are backed up by RDS every 5 minutes
        - 7 day retention but can be increased to 35
        - snapshots: retention ob backup for as long as you want. Manually triggered by the user
    - autoscaling: helps you increase storage dynamically
        - have to set Maximum Storage Threshold (maximum limit for DB storage)
- Read Replica vs Multi AZ
    - Read Replicas: help scale reads. up to 5 read replicas within az, cross az, or cross region. Replication is async so reads are eventually consistent. Replicas can be promoted to their own DB
        - For RDS Read Replicas within the same region, dont need to pay network cost. For example: us-east-1a to us-east-1b no cost
    - Multi AZ: sync replication. Increase availability. Failover in case of loss of AZ, loss of network. Not used fot scaling. Standby database is just for failover, no one can read or write to it till failover occurs.
        - going from single to multi az requires no downtime. Snapshot taken of first db and is used to restore standby db. Sync replication is then established between the two databases
- RDS Security
    - At rest encryption: possibility to encrypt the master and read replicas with AWS KMS - AES-256 encryption
        - encryption has to be defined at launch time
        - if the master is not encrypted, the read replicas cannot be encrypted
    - In flight encryption: SSL certificates to encrypt data to RDS in flight
    - Encrypting RDS backups: snapshots of unencrypted RDS databases are un-encrypted. So in order to encrypt an uncrypted database copy a snapshot into an encrypted one
- AWS Aurora: proprietary technology from AWS. Postgres and MySQL are both supported as AuroraDB. It is cloud optimized and faster thatn mySQL and Postgres. Storage automatically grows in increments, upto 128 TB.Aurora can have 15 replicas. Failover is instantaneous.
    - one aurora instance takes writes (master) + ASG for 15 read replicas. There is a reader endpoint where the client can connect to
    - support for cross region replication
- Aurora serverless: automated database instantiation and auto-scaling based on actual usage
    - good for infrequent, intermittent or unpredictable workloads
    - no capacity planning needed
    - pay per second, can be more cost-effective
- Aurora Multi-Master: every node does Read and Writes. This is for immediate failover of the write node
- Aurora cross region read replicas: useful for disaster recovery. Simple to put in place
- Aurora global database (recommended): 1 primary region for (read/write). upto 5 secondary (read only) regions, replication lag is less than 1 second. Upto 16 replicas per secondary region. Helps decreasing latency
- Aurora machine learning: enables you to add ML based predictions to applications via SQL. Use cases: fraud detection, ads targeting, sentiment analysis, product recommendations
- Elasticache: managed Redis or Memcached
    - caches are in-memory databases with really high performance, low latency
    - helps reduce load off of databases for read intensive workloads
- Redis vs Memcached
    - Redis: multi az auto failover, read replicas to scale reads and have high availability. Backup and restore features
        - Redis sorted sets: guarantee both uniqueness and element ordering
    - Memcached: multi-node for partitioning of data (sharding), no high availability (replication). Non persistent. No backup and restore
- Patterns for Elasticache
    - Lazy loading: all the read data is cached, data can become stale in cache
    - Write through: adds or update data in the cache when written to a DB (no stale data)
    - session store: store temporary session data in a cache (using TTL features)

## Route 53

- Route53 is managed DNS
- DNS is collection of rules and records which helps clients understand how to reach a server through its domain name
- Most common records
    - A: hostname to IPv4
    - AAAA: hostname to IPv6
    - CNAME: hostname to hostname
    - Alias: hostname to AWS resource
- Route53 can use public and private domains
- Route53 features
    - Load balancing
    - Health checks
    - Routing policy: simple, failover, geolocation, latency, weighted, multi value
- TTL (Time to Live)
    - web browsers and client to cahce DNS query. This is so queries are not made to route 53 to get the A record. The IP will be stored in the browser till TTL expires
        - High TTL: about 24 hours. Less traffic on DNS. Posibly outdated records
        - Low TTL: about 60 s. More traffic on DNS. Records are outdated for less time. Easy to change records
    - TTL is mandatory for each DNS record
- ELB is used to load balance in a single region. Route 53 intended to help balance traffic across regions
- CNAME vs Alias
    - CNAME: hostname -> hostname
        - Only for non root domain (ex: something.mydomain.com)
    - Alias (type A record): hostname -> AWS resource
        - Works for root and non root domain
        - Free of charge
        - Native health check
- Routing Policies
    - Simple Routing
        - Web browser asks for domain and Route 53 returns A record
        - Use when you need to redirect to a single source
        - Can't attach health checks to simple routing policy
        - If multiple values are returned, a random one is chosen by client. This can be used to do clientside loadbalancing
    - Weighted Routing
        - Control the % of the requests that go to specific endpoint
        - Helpful to test a certain percent of traffic on a new app version
        - Helpful to split traffic between two regions
        - Can be associated with health checks
    - Latency Routing
        - Most often the most suitable routing policy
        - Redirect to the server that has the least latency close to us
        - Latency is evaluated in terms of user to designated AWS region
    - Health Check
        - deemed unhealthy if fails 3 checks in a row
        - default health check interval 30s
        - integrate these health check with cloudwatch
    - Failover Routing Policy
        - There is route53 and two ec2 instances: primary, secondary(disaster recovery)
        - Health check for primary and if it fails then failover to secondary
    - Geolocation Routing
        - Routing based on user location
        - Need to create a default policy in case there's no match on location
    - Multi value routing policy
        - use when routing traffic to multiple resources
        - want to associate a route 53 health checks with records
        - basically simple routing with health checks
        - up to 8 healthy records returned for each multi value query
        - multi value is not a substitue for having an elb
- Domain registrar vs DNS Service
    - buy or register domain name with a Domain registrar. Typically comes with a DNS service to manage DNS records

## Architecture Discussions

- WhatsTheTime.com: allows people to know what time it is
    - dont need a database, start small and accept downtime, eventually fully scale vertically and horizontally (no downtime)
    - start with t2 micro with elastic ip. as demand increase then scale veritcally and use m5. with more demand make more (m5 with asg) with route53 + elb with load balancer and multi az
- MyClothes.com: allows people to buy clothes online
    - there is a shopping cart, jundreds of users at the same time, need to scale and maintain horizontal scalability and keep our web application as stateless as possible. Users should not lose their shopping cart. users should have their details in a database
    - use elb stickiness so all requests go to same instance, but however if instance goes down then lose state
    - user cookies can be used to keep track of whats in the shopping cart, but http request gets heavier. there is security risk as cookies can be altered. Therefore cookies must be validated in ec2 instance
    - using server session we just send session_id. Session id is used to store data in elasticache, dynamodb can also be used but slower. Since users do reads more often so we can have read replicas, or we can use write through cache pattern
- MyWordPress.com: fully scalable wordpress
    - website to access and correctly display picture uploads. User data
    - use EFS for shared storage between EC2 instances
- Instantiating applications quickly
    - EC2 Instances
        - Golden AMI
        - Bootstrap using User Data
        - Hybrid
    - RDS Databases
    - EBS Volumes
- ElasticBeanstalk: developer centric view of deploying an application on AWS. It is a managed service
    - Web Tier
    - Worker Tier: SQS queue